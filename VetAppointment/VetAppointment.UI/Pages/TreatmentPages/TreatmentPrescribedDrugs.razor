@page "/treatment/{TreatmentId:guid}/prescribeddrugs"

<PageTitle>Prescribed Drugs</PageTitle>

@if (PrescribedDrugsToGet == null)
{
    <p><em>Loading prescribed drugs...</em></p>
}
else
{
    <tabel id="inner" class="table table-light">
        <thead class="table-primary">
            <tr>
                <th>Prescribed Drug Id</th>
                <th>Source Drug Id</th>
                <th>Drug Quantity</th>
                <th>Drug Total Cost</th>
                <th>Edit</th>
                <th>Delete</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var drug in PrescribedDrugsToGet)
            {
                <tr>
                    <td>@drug.Id</td>
                    <td>@drug.DrugToPrescribeId</td>
                    <td>@drug.Quantity</td>
                    <td>@drug.TotalCost</td>
                    <td><button type="button" class="btn btn-info" @onclick="(() => NavigateToEditPage(drug.Id))">Edit</button></td>
                    <td><button type="button" class="btn btn-danger" @onclick="(() => DeletePrescribedDrug(drug.Id))">Delete</button></td>
                </tr>
            }
        </tbody>
    </tabel>
}

<h3>Add Prescribed Drugs to Treatment</h3>
@if (DrugIds == null)
{
    <p><em>Loading drugs...</em></p>
}
else
{
    <EditForm class="container" Model="PrescribedDrugsInTreatment" OnValidSubmit="AddPrescribedDrugsToTreatment">
        <FluentValidationValidator />
        <ObjectGraphDataAnnotationsValidator />
        <div id="1" class="input-group">
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[0].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[0].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-1" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[0].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[0].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="2" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[1].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[1].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-2" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[1].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[1].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="3" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[2].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[2].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-3" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[2].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[2].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="4" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[3].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[3].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-4" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[3].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[3].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="5" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[4].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[4].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-5" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[4].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[4].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="6" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[5].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[5].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-6" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[5].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[5].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="7" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[6].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[6].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-7" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[6].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[6].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="8" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[7].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[7].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-8" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[7].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[7].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="9" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[8].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[8].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-9" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[8].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[8].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div id="10" class="input-group" hidden>
            <div class="form-group">
                <label>Drug ID</label>
                <DropDownList DataSource="DrugIds" @bind-SelectedValues="PrescribedDrugsInTreatment.PrescribedDrugs[9].DrugId" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[9].DrugId)"></ValidationMessage>
            </div>
            <div class="form-group">
                <label>Quantity</label>
                <InputNumber id="quantity-10" @bind-Value="PrescribedDrugsInTreatment.PrescribedDrugs[9].Quantity" placeholder="Quantity" class="form-control" />
                <ValidationMessage For="@(() => PrescribedDrugsInTreatment.PrescribedDrugs[9].Quantity)"></ValidationMessage>
            </div>
        </div>

        <div class="buttons space-top">
            <button id="addRow" type="button" class="btn btn-info float-right" @onclick="AddInputFields">+</button>
            <button id="removeRow" type="button" class="btn btn-danger" @onclick="RemoveInput">-</button>
        </div>

        <div id="error-overflow" class="row" hidden="hidden">
            <div class="col">
                <p>You can only add 10 prescribed drugs to a treatment at a time.</p>
            </div>
        </div>

        <div id="error-removal" class="row" hidden="hidden">
            <div class="col">
                <p>You have to add at least one prescribed drug to a treatment.</p>
            </div>
        </div>

        <div id="newRow">
            <input type="hidden" id="total" value="1" />
        </div>

        <div class="row space-top space-bottom">
            <div class="col">
                <button type="submit" class="btn btn-success">Add prescribed drugs</button>
            </div>
        </div>
    </EditForm>
}

<div class="row">
    <div class="col">
        <button type="button" class="btn btn-info" @onclick="NavigateBack">Cancel and back</button>
    </div>
</div>